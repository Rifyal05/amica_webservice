<div x-show="currentView === 'settings'" x-transition.opacity x-cloak>

    <!-- Header -->
    <div class="mb-8">
        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Pengaturan Akun</h2>
        <p class="text-sm text-gray-500 dark:text-gray-400">Kelola informasi profil, keamanan, dan preferensi
            tampilanmu.</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <!-- KOLOM KIRI: PROFIL (Lebih Lebar) -->
        <div class="lg:col-span-2 space-y-6">

            <!-- Kartu Profil -->
            <div
                class="bg-white dark:bg-[#161b22] p-6 rounded-2xl border border-gray-200 dark:border-white/5 shadow-sm relative overflow-hidden">
                <div class="flex flex-col sm:flex-row items-start gap-6">

                    <!-- Foto Profil dengan Overlay Edit -->
                    <div class="shrink-0 relative group">
                        <div class="w-24 h-24 sm:w-28 sm:h-28 rounded-full bg-gray-100 dark:bg-gray-800 overflow-hidden border-4 border-white dark:border-[#161b22] shadow-lg cursor-pointer"
                            @click="$refs.fileInput.click()">
                            <img x-show="user.avatar_url" :src="getAvatarUrl(user.avatar_url)"
                                class="w-full h-full object-cover" referrerpolicy="no-referrer"
                                onerror="this.style.display='none'">
                            <div x-show="!user.avatar_url"
                                class="w-full h-full flex items-center justify-center text-gray-400 font-bold text-3xl"
                                x-text="(user.display_name||'A').charAt(0)"></div>

                            <!-- Overlay Icon Kamera -->
                            <div
                                class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z">
                                    </path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                            </div>
                        </div>
                        <p class="text-xs text-center mt-2 text-gray-500">Klik untuk ubah</p>
                        <input type="file" x-ref="fileInput" @change="handleFileSelect" class="hidden" accept="image/*">
                    </div>

                    <!-- Form Inputs -->
                    <div class="flex-1 w-full space-y-4">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="space-y-1">
                                <label class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Nama
                                    Tampilan</label>
                                <input type="text" x-model="formProfile.display_name"
                                    class="w-full px-4 py-2.5 rounded-xl bg-gray-50 dark:bg-[#0d1117] border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-sm font-medium"
                                    placeholder="Nama Lengkap">
                            </div>
                            <div class="space-y-1">
                                <label
                                    class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Username</label>
                                <input type="text" x-model="formProfile.username"
                                    class="w-full px-4 py-2.5 rounded-xl bg-gray-50 dark:bg-[#0d1117] border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-sm font-medium"
                                    placeholder="Username">
                            </div>
                        </div>

                        <div class="space-y-1">
                            <label class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Email</label>
                            <input type="email" x-model="formProfile.email"
                                class="w-full px-4 py-2.5 rounded-xl bg-gray-50 dark:bg-[#0d1117] border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-sm font-medium"
                                placeholder="email@contoh.com">
                        </div>

                        <div class="pt-2 flex justify-end">
                            <button @click="updateProfile()" :disabled="!isProfileChanged"
                                :class="!isProfileChanged ? 'opacity-50 cursor-not-allowed bg-gray-400' : 'bg-blue-600 hover:bg-blue-700 shadow-lg shadow-blue-500/20 active:scale-95'"
                                class="px-6 py-2.5 text-white rounded-xl text-sm font-bold transition-all">
                                Simpan Perubahan
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Kartu PIN Keamanan -->
            <div
                class="bg-white dark:bg-[#161b22] p-6 rounded-2xl border border-gray-200 dark:border-white/5 shadow-sm">
                <h3 class="font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z">
                        </path>
                    </svg>
                    PIN Kunci
                </h3>
                <div class="space-y-4">
                    <div class="space-y-1">
                        <label class="text-xs font-semibold text-gray-500 uppercase tracking-wider">PIN Lama</label>
                        <input type="password" x-model="pinForm.old" maxlength="6"
                            class="w-full px-4 py-2.5 rounded-xl bg-gray-50 dark:bg-[#0d1117] border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-sm tracking-widest text-center"
                            placeholder="• • • • • •">
                        <p class="text-[10px] text-gray-400">Kosongkan jika belum pernah set PIN</p>
                    </div>

                    <div class="space-y-1">
                        <label class="text-xs font-semibold text-gray-500 uppercase tracking-wider">PIN Baru (6
                            Angka)</label>
                        <input type="password" x-model="pinForm.new" maxlength="6"
                            class="w-full px-4 py-2.5 rounded-xl bg-gray-50 dark:bg-[#0d1117] border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-sm tracking-widest text-center"
                            placeholder="• • • • • •">
                    </div>

                    <button @click="updatePin()"
                        class="w-full py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-xl text-sm font-bold transition-all active:scale-95 shadow-lg shadow-blue-500/20">
                        Simpan PIN
                    </button>
                </div>
            </div>

            <!-- BLOK AKUN GOOGLE (SMART CONNECT) -->
            <div
                class="bg-white dark:bg-[#161b22] p-6 rounded-2xl border border-gray-200 dark:border-white/5 shadow-sm mt-6">
                <h3 class="font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5" viewBox="0 0 24 24">
                        <path
                            d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                            fill="#4285F4" />
                        <path
                            d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                            fill="#34A853" />
                        <path
                            d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                            fill="#FBBC05" />
                        <path
                            d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                            fill="#EA4335" />
                    </svg>
                    Google Account
                </h3>

                <!-- KONDISI 1: SUDAH TERHUBUNG -->
                <div x-show="user.google_uid"
                    class="flex items-center justify-between p-3 bg-gray-50 dark:bg-[#0d1117] rounded-xl border border-gray-100 dark:border-gray-700">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-8 h-8 rounded-full bg-white dark:bg-gray-800 flex items-center justify-center shadow-sm">
                            <span class="font-bold text-blue-500">G</span>
                        </div>
                        <div>
                            <p class="text-sm font-bold text-gray-800 dark:text-white">Terhubung</p>
                            <p class="text-xs text-gray-500 truncate max-w-[200px]" x-text="user.email"></p>
                        </div>
                    </div>
                    <button
                        class="text-[10px] font-bold px-3 py-1.5 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded-lg cursor-default">
                        Connected
                    </button>
                </div>

                <!-- KONDISI 2: BELUM TERHUBUNG -->
                <div x-show="!user.google_uid"
                    class="text-center p-4 bg-gray-50 dark:bg-[#0d1117] rounded-xl border border-gray-100 dark:border-gray-700">
                    <p class="text-xs text-gray-500 mb-3">Hubungkan akun Google untuk login lebih cepat & aman.</p>
                    <button @click="connectGoogleAccount()"
                        class="w-full flex items-center justify-center gap-2 bg-white dark:bg-[#21262d] border border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-[#30363d] text-gray-700 dark:text-gray-200 font-semibold py-2 px-4 rounded-xl transition text-sm shadow-sm">
                        <svg class="w-4 h-4" viewBox="0 0 24 24">
                            <path
                                d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                                fill="#4285F4" />
                            <path
                                d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                                fill="#34A853" />
                            <path
                                d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                                fill="#FBBC05" />
                            <path
                                d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                                fill="#EA4335" />
                        </svg>
                        Hubungkan Google
                    </button>
                </div>
            </div>
        </div>

        <!-- KOLOM KANAN: KEAMANAN & TEMA (Lebih Sempit) -->
        <div class="space-y-6">

            <!-- Kartu Tampilan (Tema) -->
            <div
                class="bg-white dark:bg-[#161b22] p-6 rounded-2xl border border-gray-200 dark:border-white/5 shadow-sm">
                <h3 class="font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01">
                        </path>
                    </svg>
                    Tampilan
                </h3>
                <div class="bg-gray-100 dark:bg-[#0d1117] p-1 rounded-xl flex">
                    <button @click="if(isDark) toggleTheme()"
                        class="flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-sm font-bold transition-all"
                        :class="!isDark ? 'bg-white shadow text-blue-600' : 'text-gray-500 hover:text-gray-700'">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                            </path>
                        </svg>
                        Light
                    </button>
                    <button @click="if(!isDark) toggleTheme()"
                        class="flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-sm font-bold transition-all"
                        :class="isDark ? 'bg-[#21262d] shadow text-yellow-400' : 'text-gray-500 hover:text-gray-700'">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z">
                            </path>
                        </svg>
                        Dark
                    </button>
                </div>
            </div>


            <div
                class="bg-white dark:bg-[#161b22] p-6 rounded-2xl border border-gray-200 dark:border-white/5 shadow-sm">
                <h3 class="font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z">
                        </path>
                    </svg>
                    Keamanan
                </h3>

                <!-- Bungkus dengan Form agar HTML5 Validation Jalan -->
                <form @submit.prevent="changePassword" class="space-y-4">

                    <!-- Input Password Lama (Hanya muncul jika bukan User Google) -->
                    <!-- Kita gunakan x-if agar elemennya benar-benar hilang dari DOM jika Google user -->
                    <template x-if="user.auth_provider !== 'google'">
                        <div class="space-y-1">
                            <label class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Password
                                Lama</label>
                            <input type="password" x-model="oldPassword" required
                                class="w-full px-4 py-2.5 rounded-xl bg-gray-50 dark:bg-[#0d1117] border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition text-sm"
                                placeholder="••••••••">
                        </div>
                    </template>

                    <!-- Pesan Info Khusus Google User -->
                    <template x-if="user.auth_provider === 'google'">
                        <p class="text-xs text-blue-500 bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg">
                            Anda login via Google. Anda bisa mengatur password baru tanpa password lama.
                        </p>
                    </template>

                    <div class="space-y-1">
                        <label class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Password
                            Baru</label>
                        <input type="password" x-model="newPassword" required minlength="6"
                            class="w-full px-4 py-2.5 rounded-xl bg-gray-50 dark:bg-[#0d1117] border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition text-sm"
                            placeholder="Minimal 6 karakter">
                    </div>

                    <button type="submit"
                        class="w-full py-2.5 bg-gray-800 hover:bg-gray-900 dark:bg-white dark:text-gray-900 dark:hover:bg-gray-100 text-white rounded-xl text-sm font-bold transition-all active:scale-95 shadow-lg">
                        Update Password
                    </button>
                </form>
            </div>

            <!-- Kartu PIN Keamanan -->
            <!-- <div class="bg-white dark:bg-[#161b22] p-6 rounded-2xl border border-gray-200 dark:border-white/5 shadow-sm mt-6">
                <h3 class="font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                    PIN Kunci
                </h3>
                <div class="space-y-4">
                    <div class="space-y-1">
                        <label class="text-xs font-semibold text-gray-500 uppercase tracking-wider">PIN Lama</label>
                        <input type="password" x-model="pinForm.old" maxlength="6" class="w-full px-4 py-2.5 rounded-xl bg-gray-50 dark:bg-[#0d1117] border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-sm tracking-widest text-center" placeholder="• • • • • •">
                        
                        <p class="text-[10px] text-gray-400 mt-1">Kosongkan jika Anda belum pernah membuat PIN.</p>
                    </div>
                    
                    <div class="space-y-1">
                        <label class="text-xs font-semibold text-gray-500 uppercase tracking-wider">PIN Baru (6 Angka)</label>
                        <input type="password" x-model="pinForm.new" maxlength="6" class="w-full px-4 py-2.5 rounded-xl bg-gray-50 dark:bg-[#0d1117] border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-sm tracking-widest text-center" placeholder="• • • • • •">
                    </div>

                    <button @click="updatePin()" class="w-full py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-xl text-sm font-bold transition-all active:scale-95 shadow-lg shadow-blue-500/20">
                        Simpan PIN
                    </button>
                </div>
            </div> -->
            <!-- Kartu Danger Zone -->
            <div
                class="bg-red-50 dark:bg-red-900/10 p-6 rounded-2xl border border-red-200 dark:border-red-900/30 shadow-sm mt-6">
                <h3 class="font-bold text-red-600 dark:text-red-400 mb-2 flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                        </path>
                    </svg>
                    Hapus Akun
                </h3>
                <p class="text-xs text-red-600/70 dark:text-red-400/70 mb-4 leading-relaxed">
                    Tindakan ini permanen. Semua data akun dan akses admin Anda akan hilang selamanya.
                </p>
                <button @click="deleteAccount()"
                    class="w-full py-2.5 bg-white border border-red-200 text-red-600 hover:bg-red-600 hover:text-white dark:bg-transparent dark:border-red-800 dark:text-red-400 dark:hover:bg-red-900/30 rounded-xl text-sm font-bold transition-all active:scale-95">
                    Hapus Akun Saya
                </button>
            </div>

        </div>
    </div>
</div>