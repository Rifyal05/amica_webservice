"""Add RAG benchmark tables

Revision ID: 50ac4a7ec1ad
Revises: 0645774bcb55
Create Date: 2026-01-15 06:05:50.620055

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '50ac4a7ec1ad'
down_revision: Union[str, None] = '0645774bcb55'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('rag_test_cases',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('question', sa.Text(), nullable=False),
    sa.Column('expected_answer', sa.Text(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('rag_benchmark_results',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('test_case_id', sa.Integer(), nullable=True),
    sa.Column('ai_answer', sa.Text(), nullable=True),
    sa.Column('bleu_score', sa.Float(), nullable=True),
    sa.Column('llama_score', sa.Float(), nullable=True),
    sa.Column('llama_reason', sa.Text(), nullable=True),
    sa.Column('latency', sa.Float(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['test_case_id'], ['rag_test_cases.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.drop_constraint(op.f('articles_author_id_fkey'), 'articles', type_='foreignkey')
    op.create_foreign_key(None, 'articles', 'users', ['author_id'], ['id'], ondelete='CASCADE')
    op.drop_constraint(op.f('audit_logs_actor_id_fkey'), 'audit_logs', type_='foreignkey')
    op.create_foreign_key(None, 'audit_logs', 'users', ['actor_id'], ['id'], ondelete='CASCADE')
    op.drop_constraint(op.f('chats_created_by_fkey'), 'chats', type_='foreignkey')
    op.create_foreign_key(None, 'chats', 'users', ['created_by'], ['id'], ondelete='SET NULL')
    op.drop_constraint(op.f('group_invites_created_by_fkey'), 'group_invites', type_='foreignkey')
    op.create_foreign_key(None, 'group_invites', 'users', ['created_by'], ['id'], ondelete='CASCADE')
    op.drop_constraint(op.f('messages_reply_to_id_fkey'), 'messages', type_='foreignkey')
    op.create_foreign_key(None, 'messages', 'messages', ['reply_to_id'], ['id'], ondelete='SET NULL')
    op.drop_constraint(op.f('quarantined_items_quarantined_by_fkey'), 'quarantined_items', type_='foreignkey')
    op.create_foreign_key(None, 'quarantined_items', 'users', ['quarantined_by'], ['id'], ondelete='SET NULL')
    op.drop_constraint(op.f('reports_reported_user_id_fkey'), 'reports', type_='foreignkey')
    op.drop_constraint(op.f('reports_reported_comment_id_fkey'), 'reports', type_='foreignkey')
    op.drop_constraint(op.f('reports_reported_post_id_fkey'), 'reports', type_='foreignkey')
    op.create_foreign_key(None, 'reports', 'posts', ['reported_post_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(None, 'reports', 'users', ['reported_user_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(None, 'reports', 'comments', ['reported_comment_id'], ['id'], ondelete='CASCADE')
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(None, 'reports', type_='foreignkey')
    op.drop_constraint(None, 'reports', type_='foreignkey')
    op.drop_constraint(None, 'reports', type_='foreignkey')
    op.create_foreign_key(op.f('reports_reported_post_id_fkey'), 'reports', 'posts', ['reported_post_id'], ['id'])
    op.create_foreign_key(op.f('reports_reported_comment_id_fkey'), 'reports', 'comments', ['reported_comment_id'], ['id'])
    op.create_foreign_key(op.f('reports_reported_user_id_fkey'), 'reports', 'users', ['reported_user_id'], ['id'])
    op.drop_constraint(None, 'quarantined_items', type_='foreignkey')
    op.create_foreign_key(op.f('quarantined_items_quarantined_by_fkey'), 'quarantined_items', 'users', ['quarantined_by'], ['id'])
    op.drop_constraint(None, 'messages', type_='foreignkey')
    op.create_foreign_key(op.f('messages_reply_to_id_fkey'), 'messages', 'messages', ['reply_to_id'], ['id'])
    op.drop_constraint(None, 'group_invites', type_='foreignkey')
    op.create_foreign_key(op.f('group_invites_created_by_fkey'), 'group_invites', 'users', ['created_by'], ['id'])
    op.drop_constraint(None, 'chats', type_='foreignkey')
    op.create_foreign_key(op.f('chats_created_by_fkey'), 'chats', 'users', ['created_by'], ['id'])
    op.drop_constraint(None, 'audit_logs', type_='foreignkey')
    op.create_foreign_key(op.f('audit_logs_actor_id_fkey'), 'audit_logs', 'users', ['actor_id'], ['id'])
    op.drop_constraint(None, 'articles', type_='foreignkey')
    op.create_foreign_key(op.f('articles_author_id_fkey'), 'articles', 'users', ['author_id'], ['id'])
    op.drop_table('rag_benchmark_results')
    op.drop_table('rag_test_cases')
    # ### end Alembic commands ###
